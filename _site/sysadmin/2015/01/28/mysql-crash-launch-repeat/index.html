<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <meta http-equiv="X-UA-Compatible" content="IE=edge" />

      <title>MySql crash launch repeat</title>
      <meta name="description" content="I lead Security @Docker, advise a handful of Startups and do Security Research. Follow @diogomonica on twitter or learn a little bit more about me." />

      <meta name="HandheldFriendly" content="True" />
      <meta name="MobileOptimized" content="320" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />

      <link rel="alternate" type="application/rss+xml" href="//feed.xml">
      <link rel="shortcut icon" href="/favicon.ico">
      <link rel="prefetch" href="/">
      <link rel="canonical" href="//sysadmin/2015/01/28/mysql-crash-launch-repeat/">

      <link rel="stylesheet" href="/assets/css/init.css">
      <link href='//fonts.googleapis.com/css?family=Domine:700|Open+Sans:400,600|Source+Code+Pro:500' rel='stylesheet' type='text/css'>
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  </head>
  <body>

    <header class="title">
    <a href="/"><i class="fa fa-bookmark-o fa-lg"></i><span>Diogo Monica</span></a>
</header>

<nav class="wrapper  ">
    <a href="#" onclick="return false;"><i class="fa fa-navicon fa-lg"></i></a>
    <ul>
        
            <li><a href="/about/">About</a></li>
        
            
        
            
        
            
        
    </ul>
</nav>


    <div class="index">
    <div class="wrapper">
        <h1 class="right">MySql crash launch repeat</h1>
        <h2 class="left">Introduction</h2>
    </div>
</div>

<div class="profile ">
    <img src="/assets/img/diogo_monica_14_cropped_small.png" class="profileimage" alt="user">
    <h4>Diogo Monica</h4>
    <ul>
    	
        <li><a href="https://twitter.com/diogomonica" class="smallsocialbutton twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
        
        
        <li><a href="https://facebook.com/diogomonica" class="smallsocialbutton facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
        
        
        <li><a href="https://github.com/diogomonica" class="smallsocialbutton github" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
        <li><a href="" class="smallsocialbutton instagram" target="_blank"><i class="fa fa-instagram"></i></a></li>
        
        <li><a href="//feed.xml" class="smallsocialbutton rss" target="_blank"><i class="fa fa-rss"></i></a></li>
    </ul>
    <p>I lead Security @Docker, advise a handful of Startups and do Security Research. Follow @diogomonica on twitter or learn a little bit more about me.</p>
    <hr>
</div>

<div id="cover" class="cover ">
    <div class="background" style="background-image:url('');"></div>
    <header class="wrapper">
        <h2>
        	
				sysadmin 
          	
        </h2>
        <h1><a href="/sysadmin/2015/01/28/mysql-crash-launch-repeat/">MySql crash launch repeat</a></h1>
        <span>
            Posted by <a href="https://diogomonica.com" target="_blank">Diogo Monica</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2015-01-28">January 28, 2015</time>.
        </span>
    </header>
    <i class="fa fa-chevron-down movedown"></i>
</div>

<section class="posts wrapper">
    <article class="post ">
        
        <header>
            <div class="feature"><span>Featured</span><i class="fa fa-bookmark fa-lg"></i></div>
            <h2>
            	
					sysadmin 
          		
            </h2>
            <h1 id="posttitle"><a href="#">MySql crash launch repeat</a></h1>
            <span>
                Posted by <a href="" target="_blank">Diogo Monica</a>
                on <i class="fa fa-clock-o"></i> <time datetime="2015-01-28">January 28, 2015</time>.
            </span>
        </header>

        <section class="postbody">
            <h2 id="frugal-wordpress-setup">Frugal Wordpress setup</h2>
<p>When you want to setup a wordpress server with decent performance at a low cost, nothing beats digital ocean. This is of course my opinion, but $5/month is hard to beat! The only caveat is 512mb of memory.
<!--more--></p>

<h2 id="mb-is-like-raspberry-pi">512mb is like Raspberry Pi</h2>
<p>To give some context, only having a 512mb droplet is like having a Rasberry Pi dedicated for your web server. Which there is nothing wrong with that if you do not expect heavy traffic or heavy processing.</p>

<h2 id="mysql-will-die">MySql will die…</h2>
<p>Eventually, MySql will simply quit. While it seems like the server can handle Wordpress no problem with great speed for such a small droplet, MySql running in parallel can’t seem to take it.</p>

<h2 id="the-consensus">The consensus</h2>
<p>As you might have guessed, I had an issue with MySql crashing on my server. I read through some of the community questions on Digital Ocean. Mainly these two articles, <a href="https://www.digitalocean.com/community/questions/mysql-keeps-crashing-on-512mb-droplet">MySql keeps crashing on 512mb droplet</a> and <a href="https://www.digitalocean.com/community/questions/mysql-on-ubuntu-keeps-crashing">MySql on Ubuntu keeps crashing</a>. The general consensus is to either create a swap or upgrade to a bigger server. Although it seemed like users were having issues with both solutions. When hope was almost lost, I saw a comment where one guy was manually restarting MySql server every time it crashed. Then thought came acrossed my mind… couldn’t you just automate that?</p>

<h2 id="automate-it">Automate it</h2>
<p>Before you dish out more money to upgrade your perfectly good toy like server, let me help you automate this process of restarting the MySql server. So keep your money in your pockets. I admit this is probably not the most ideal of solutions, but it will work and keep your MySql server going. I also want to disclaim since this checks the status every minute, you could experience one minute of down time. So if you are okay with that, carry on!</p>

<p>Create a script file called <code>restart-mysql.sh</code> and place it in root directory on your server. You could call it whatever you want and place it where every you’d like, just keep in mind of both for the next step.</p>

<p>Add this code to that file:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
<span class="k">if</span> <span class="o">[[</span> ! <span class="s2">&quot;$(/usr/sbin/service mysql status)&quot;</span> <span class="o">=</span>~ <span class="s2">&quot;start/running&quot;</span> <span class="o">]]</span>
<span class="k">then</span>
        /etc/init.d/mysql start
<span class="k">fi</span></code></pre></div>

<p>~<a href="http://askubuntu.com/questions/451839/shell-script-issue-cron-job-script-to-restart-mysql-server-when-it-stops-accide">solution source</a></p>

<p>Make sure the script is executable by running this: <code>chmod +x /restart-mysql.sh</code></p>

<p>Add this to the cron tab by doing the following:</p>

<ul>
  <li><code>sudo crontab -e</code> to edit the root contab file</li>
  <li>Then add this line to the file: <code>*/1 * * * * /restart-mysql.sh</code></li>
</ul>

<h2 id="results">Results</h2>
<p>What this will do is poll the status of MySql every minute. If the status is “start/running”, it will start MySql again. This should be enough to keep your server going like the energizer bunny.</p>


        </section>

        <footer>
            <ul class="share left">
                <li><a href="http://twitter.com/share?text=MySql crash launch repeat&url=//sysadmin/2015/01/28/mysql-crash-launch-repeat/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" class="smallbutton lightgray"><i class="fa fa-twitter"></i>Twitter</a></li>
                <li><a href="https://www.facebook.com/sharer/sharer.php?u=//sysadmin/2015/01/28/mysql-crash-launch-repeat/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" class="smallbutton lightgray"><i class="fa fa-facebook"></i>Facebook</a></li>
            </ul>
        </footer>

        <div class="postprofile">
            <img src="/assets/img/diogo_monica_14_cropped_small.png" class="author" alt="user">
            <div class="info">
                <h4>Diogo Monica</h4>
                <a href="https://diogomonica.com">https://diogomonica.com</a>
                <p>I lead Security @Docker, advise a handful of Startups and do Security Research. Follow @diogomonica on twitter or learn a little bit more about me.</p>
                <ul class="social">
       				
                    <li><a href="https://twitter.com/diogomonica" class="twitter" target="_blank"><i class="fa fa-twitter"></i></a></li>
                    
					
                    <li><a href="https://facebook.com/diogomonica" class="facebook" target="_blank"><i class="fa fa-facebook"></i></a></li>
                    
					
                    <li><a href="https://github.com/diogomonica" class="github" target="_blank"><i class="fa fa-github-alt"></i></a></li>
                    
					
                    <li><a href="" class="instagram" target="_blank"><i class="fa fa-instagram"></i></a></li>
					
					
                    <li><a href="https://www.linkedin.com/in/diogomonica" class="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a></li>
					
                    <li><a href="//feed.xml" class="rss" target="_blank"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
        </div>

        

    </article>

</section>


    <footer class="wrapper">
    <div class="smallnav">
    	
        	<a href="/about/">About</a> &bull;
        
        	
        
        	
        
        	
        
    </div>
    <div>
        Copyright &copy; <a href="//">Diogo Monica</a>. 2014 &bull; All rights reserved.
        <span class="ghost">Proudly published with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>.</span>
    </div>
</footer>

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
      var config = {
        'disqus_shortname': '',
        'google_comments': false,
        'analytics_id': '',
        'analytics_domain': '',
        'readingtime': true,
        'autoload_comments': false
      };
    </script>
    <script async type="text/javascript" src="/assets/js/theme.js"></script>

  </body>
</html>
